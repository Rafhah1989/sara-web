<div class="container page-container">
    <div class="header-section">
        <h1 class="cinzel-font color-primary-gold-dark">Listagem de Pedidos</h1>
        <button class="btn-gold" (click)="novoPedido()">Novo Pedido</button>
    </div>

    <div class="filter-section card">
        <div class="row">
            <div class="col-md-3">
                <label>Por Cliente</label>
                <input type="text" [(ngModel)]="filtroCliente" (input)="filtrarPedidos()" placeholder="Nome do cliente"
                    class="form-control">
            </div>
            <div class="col-md-2">
                <label>Número do Pedido</label>
                <input type="number" [(ngModel)]="filtroId" (input)="filtrarPedidos()" placeholder="ID"
                    class="form-control">
            </div>
            <div class="col-md-2">
                <label>Data Início</label>
                <input type="date" [(ngModel)]="filtroDataInicio" (change)="filtrarPedidos()" class="form-control">
            </div>
            <div class="col-md-2">
                <label>Data Fim</label>
                <input type="date" [(ngModel)]="filtroDataFim" (change)="filtrarPedidos()" class="form-control">
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button class="btn btn-secondary" (click)="limparFiltros()">Limpar</button>
            </div>
        </div>
        <div class="row" style="margin-top: 10px;">
            <div class="col-md-12 checkbox-container">
                <div class="form-check" style="display: flex; flex-direction: row; align-items: center;">
                    <input class="form-check-input" type="checkbox" id="exibirCancelados" [(ngModel)]="exibirCancelados"
                        (change)="filtrarPedidos()"
                        style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                    <label class="form-check-label" for="exibirCancelados" style="margin-bottom: 0; cursor: pointer;">
                        Exibir Cancelados
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="table-section card">
        <table class="table">
            <thead>
                <tr>
                    <th (click)="alternarOrdenacao('id')" class="sortable">
                        Número <i class="fa" [ngClass]="getSortIcon('id')"></i>
                    </th>
                    <th (click)="alternarOrdenacao('usuario.nome')" class="sortable">
                        Cliente <i class="fa" [ngClass]="getSortIcon('usuario.nome')"></i>
                    </th>
                    <th (click)="alternarOrdenacao('dataPedido')" class="sortable">
                        Data <i class="fa" [ngClass]="getSortIcon('dataPedido')"></i>
                    </th>
                    <th>Valor Total</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let pedido of pedidos" [class.pedido-cancelado]="pedido.cancelado">
                    <td>{{ pedido.id }}</td>
                    <td>{{ pedido.usuarioNome }}</td>
                    <td>{{ pedido.dataPedido | date:'dd/MM/yyyy HH:mm' }}</td>
                    <td>{{ pedido.valorTotal | currency:'BRL' }}</td>
                    <td>{{ pedido.cancelado ? 'Cancelado' : 'Ativo' }}</td>
                    <td class="actions">
                        <button class="btn-icon" title="Gerar PDF" (click)="gerarPdf(pedido.id)">
                            <i class="fa fa-file-pdf-o">PDF</i>
                        </button>
                        <button class="btn-icon" title="Editar/Visualizar" (click)="editarPedido(pedido.id)"
                            [disabled]="pedido.cancelado">
                            <i class="fa fa-pencil">Editar</i>
                        </button>
                        <button class="btn-icon" title="Cancelar" *ngIf="!pedido.cancelado"
                            (click)="cancelarPedido(pedido)">
                            <i class="fa fa-trash">Cancelar</i>
                        </button>
                    </td>
                </tr>
                <tr *ngIf="pedidos.length === 0 && !loading">
                    <td colspan="6" class="text-center">Nenhum pedido encontrado.</td>
                </tr>
            </tbody>
        </table>

        <div class="pagination-footer">
            <select [(ngModel)]="pageSize" (change)="carregarPedidos()">
                <option *ngFor="let option of pageSizeOptions" [value]="option">{{ option }} por página</option>
            </select>
            <div class="pagination-controls">
                <button [disabled]="currentPage === 0"
                    (click)="currentPage = currentPage - 1; carregarPedidos()">Anterior</button>
                <span>Página {{ currentPage + 1 }}</span>
                <button [disabled]="(currentPage + 1) * pageSize >= totalElements"
                    (click)="currentPage = currentPage + 1; carregarPedidos()">Próxima</button>
            </div>
            <span>Total: {{ totalElements }}</span>
        </div>
    </div>
</div>

<!-- Frame de Aviso PDF -->
<div class="modal-overlay" *ngIf="avisoPdf">
    <div class="modal-content">
        <h2 class="cinzel-font">Gerando PDF</h2>
        <p>O PDF com as informações do pedido está sendo gerado e baixado.</p>
        <button class="btn btn-primary" (click)="fecharAvisoPdf()">OK</button>
    </div>
</div>